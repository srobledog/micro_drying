---
title: "R Notebook"
output: html_notebook
---

```{r message=FALSE, warning=FALSE, echo=FALSE}
library(tidyverse, warn.conflicts = FALSE)
library(tosr)
library(bibliometrix)
library(here)
library(rmendeley)
library(lubridate)
```

# Data loading

```{r}
wos_1_1000 <- 
  bibliometrix::convert2df(here("data", 
                                c("WoS_1_500.txt",
                                  "WoS_501_1000.txt")), 
                           dbsource = "wos", 
                           format = "plaintext")


wos_1001_1469 <- 
  convert2df(here("data", 
                  "WoS_1001_1469.txt"), 
             dbsource = "wos", 
             format = "plaintext")

wos <- 
  wos_1_1000 |> 
  bind_rows(wos_1001_1469)

rm(wos_1_1000, wos_1001_1469)


scopus <- 
  convert2df(here("data", "scopus 1791 31 03 2022.bib"), 
             dbsource = "scopus", 
             format = "bibtex")

source("/Users/sebastianrobledo/Google Drive/My Drive/A. RESEARCH/Papers Luis Amigo/Castro 2022 Aplicaciones/micro_drying/data/mergingdata.R")

```

# Data tidying

```{r}

```


# Descriptive Analysis

```{r}
table_1 <- 
  tibble(wos = length(wos$SR), # Create a dataframe with the values.
         scopus = length(scopus$SR), 
         total = length(wos_scopus_tos$df$SR))
table_1
```

```{r}
wos_anual_production <- 
  wos |> 
  select(PY) |> 
  count(PY, sort = TRUE) |> 
  na.omit() |> 
  filter(PY >= 2000,
         PY < year(today())) |> 
  mutate(ref_type = "wos")
scopus_anual_production  <- 
  scopus |> 
  select(PY) |> 
  count(PY, sort = TRUE) |> 
  na.omit() |> 
  filter(PY >= 2000,
         PY < year(today())) |>
  mutate(ref_type = "scopus")
total_anual_production <- 
  wos_scopus_tos$df |> 
  select(PY) |> 
  count(PY, sort = TRUE) |> 
  na.omit() |> 
  filter(PY >= 2000,
         PY < year(today())) |>
  mutate(ref_type = "total")
wos_scopus_total_annual_production <- 
  wos_anual_production |> 
  bind_rows(scopus_anual_production,
            total_anual_production) 

wos_scopus_total_annual_production |> 
  ggplot(aes(x = PY, y = n, color = ref_type)) +
  geom_line() +
  labs(title = "Annual Scientific Production", 
       x = "years",
       y = "papers") +
  theme(plot.title = element_text(hjust = 0.5)) 

```



# Exporitng data

```{r}
write_csv(micro_drying, here("output", "micro_drying.csv"))
```


